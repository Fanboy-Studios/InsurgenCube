// Decides whether to open the admin or normal in-game menu.
alias ingamemenu [ if (currole 1) [ showmenu "In-game admin" ] [ showmenu In-game ] ]

// "Join server" menu.
alias joinservermenu [ searchlan 1
		showallservers 1
		showonlyfavourites 0
		updatefrommaster
		showmenu server
	]

// Normal in-game menu that opens when pressing escape and connected to a game.
newmenu "In-game"

menuitemtextinput (getlang m_mp_ingame_nick) "result $curname" "name $arg1"
menuitem (getlang m_mp_ingame_defect) 		"changeteam"
menuitem (getlang m_mp_ingame_spect) 		"team SPECT"
menuitem (getlang m_mp_ingame_change_weap) 	"showmenu Weapons"
menuitem (getlang m_mp_ingame_change_perk) 	"showmenu Perks"
menuitem (getlang m_mp_ingame_change_skin) 	[showmenu (at [RED BLUE] (curteam))]
menuitem "" -1
menuitem (getlang m_mp_ingame_map) 			"showmenu Gamemode"
menuitem (getlang m_mp_ingame_kb) 			"showmenu kick/ban"
menuitem (getlang m_mp_ingame_team) 		[ showmenu "Team adjustment" ]
menuitem (getlang m_mp_ingame_bot) 			[ showmenu "Bot control" ]
menuitem (getlang m_mp_ingame_ip) 			[ showmenu "WHOIS" ]
menuitem (getlang m_mp_ingame_demo) 		[ listdemos; showmenu "Download demo" ]
menuitem (getlang m_mp_ingame_additional) 	"showmenu [serverinfo]"
menuitem "" -1
menuitem "4Main menu..."		[ closemenu In-game; showmenu main ]
menuitem "4Browse servers..."	[ closemenu "In-game"; joinservermenu ]
menuitem "3Disconnect from server"	"disconnect"
menuitem "3Quit AssaultCube Reloaded"		"savequit"
menuinitselection 12

// In-game menu that opens if when you press escape if you're admin state and connected to a game.
newmenu "In-game admin"

menuitem (getlang m_mp_ingame_map) 				"showmenu Gamemode"
menuitem (getlang m_mp_ingame_kb) 				"showmenu kick/ban"
menuitem (getlang m_mp_ingame_team) 			[ showmenu "Team adjustment" ]
menuitem (getlang m_mp_ingame_bot) 				[ showmenu "Bot control" ]
menuitem (getlang m_mp_ingame_admin_mm) 		"showmenu Mastermode"
menuitem (getlang m_mp_ingame_admin_servdesc) 	"saycommand /serverdesc "
menuitem (getlang m_mp_ingame_ip) 				[ showmenu "WHOIS" ]
menuitem (getlang m_mp_ingame_admin_give) 		[ showmenu "give permission" ]
menuitem (getlang m_mp_ingame_admin_revoke) 	[ showmenu "revoke privilege" ]
menuitem "" -1
menuitemtextinput (getlang m_mp_ingame_nick) 	"result $curname" "name $arg1"
menuitem (getlang m_mp_ingame_defect) 			"changeteam"
menuitem (getlang m_mp_ingame_spect) 			"team SPECT"
menuitem (getlang m_mp_ingame_change_weap) 		"showmenu Weapons"
menuitem (getlang m_mp_ingame_change_perk) 		"showmenu Perks"
menuitem (getlang m_mp_ingame_change_skin) 		[showmenu (at [RED BLUE] (curteam))]
menuitem (getlang m_mp_ingame_admin_demo) 		"showmenu Demo"
menuitem "" -1
menuitem "4Main menu..."		[ closemenu "In-game admin"; showmenu main ]
menuitem "4Browse servers..."		[ closemenu "In-game admin"; joinservermenu ]
menuitem "3Disconnect from server"	"disconnect"
menuitem "3Quit AssaultCube Reloaded"		"savequit"

// Multiplayer menu only opens through the main menu (when disconnected).
newmenu multiplayer

menuitem (getlang m_mp_join) 	"joinservermenu"
menuitem (getlang m_mp_lan) 	"searchlan 2; showallservers 0; showmenu server"
menuitem (getlang m_mp_pwd) 	[ showmenu "Custom connect" ]
menuitem "" -1
menuitem (getlang m_mp_update) 	"updatefrommaster 1; showmenu server"

// Fancy custom connect menu.
newmenu "Custom connect"

menuinit [ alias cc1 ""; alias cc2 ""; alias cc3 "" ]	// Resets the aliases
menuitemtextinput (getlang m_mp_cc_ipd) 	"" "alias cc1 $arg1" "" 255 
menuitemtextinput (getlang m_mp_cc_port) 	"" "alias cc2 $arg1" "" 6
menuitemtextinput (getlang m_mp_cc_pwd) 	"" "alias cc3 $arg1" "" 128
menuitem "" -1
menuitem "2			 [ Connect ]			" "connect $cc1 $cc2 $cc3"

_kickbanaction = kick
newmenu reason
menuinit [ _kickbanreason = "None"; if (strcmp $_kickbanaction kick) [ ] [ if (strcmp $_kickbanaction ban) [ ] [ _kickbanaction = ban ] ] ]
//menuitem "intentional TK" [ _kickbanreason = "intentional TK"; showmenu (concat $_kickbanaction player) ]
menuitem "abusive behavior" [ _kickbanreason = "abusive behavior"; showmenu (concat $_kickbanaction player) ]
menuitem "bad language" [ _kickbanreason = "bad language"; showmenu (concat $_kickbanaction player) ]
//menuitem "" [ _kickbanreason = ""; showmenu (concat $_kickbanaction player) ]
menuitem "cheats" [ _kickbanreason = "cheater"; showmenu (concat $_kickbanaction player) ]
menuitemtextinput "Reason: " "" "_kickbanreason = $arg1" "" 255
menuitem $_kickbanaction "showmenu (concat $_kickbanaction player)"
menuinitselection 2

newmenu kick/ban
menuitem (getlang m_mp_kb_kick)			[ _kickbanaction = kick; showmenu reason ]
menuitem (getlang m_mp_kb_ban) 		[ _kickbanaction = ban; showmenu reason ]
//menuitem (getlang m_mp_kb_kick) 		[ showmenu "kick player" ]
//menuitem (getlang m_mp_kb_ban) 			[ showmenu "ban player" ]
menuitem (getlang m_mp_kb_clearbans) 	"removebans"

newmenu "Team adjustment"

menuitem (getlang m_mp_team_shuffle)	"shuffleteams"
menuitem (getlang m_mp_team_force)		[ showmenu "force team" ]
menuitem (getlang m_mp_team_spect)		[ showmenu "toggle spect" ]
menuitem (getlang m_mp_team_auto)		"showmenu Auto-team"

newmenu Gamemode
menuitem "Deathmatch"				"mode 2; showmenu Mutators"
menuitem "Capture-the-Flag"			"mode 3; showmenu MutatorsF"
menuitem "Hunt-the-Flag"			"mode 4; showmenu Mutators"
menuitem "Keep-the-Flag"			"mode 5; showmenu MutatorsF"
menuitem "Bomber"					"mode 6; showmenu MutatorsF"
menuitem "Zombie"					"mode 7; showmenu Mutators"
menuitem
menuitem "Coopedit"					"mode 1; showmenu maps"
menuitem "show old modes" [ showmenu "Classic modes" ]

newmenu Mutators
menuitemmuts 0 // team
menuitemmuts 1 // classic
menuitemmuts 2 // confirm
menuitemmuts 3 // convert
menuitem
menuitemmuts 4 // real
menuitemmuts 5 // expert
menuitem
menuitemmuts 6 // insta
menuitemmuts 7 // pistol
menuitemmuts 8 // gib
menuitemmuts 9 // knife
menuitem
menuitemmuts 10 // gsp1
menuitem
menuitem "[ select map ]" "showmenu maps"

newmenu MutatorsF
menuitemmuts 0 // team
menuitemmuts 1 // classic
menuitemmuts 2 // confirm
menuitemmuts 3 // convert
menuitem
menuitemmuts 4 // real
menuitemmuts 5 // expert
menuitem
menuitemmuts 6 // insta
menuitemmuts 7 // pistol
menuitemmuts 8 // gib
menuitemmuts 9 // knife
menuitem
menuitemmuts 10 // gsp1
menuitem
menuitem "[ select map ]" "showmenu maps_flags"

newmenu "Classic modes"

menuitem "Team Deathmatch"				"classicmode 0; showmenu maps"
menuitem "Real-Team Deathmatch"			"classicmode 1; showmenu maps"
menuitem "Expert-Team Deathmatch"		"classicmode 2; showmenu maps"
menuitem "Classic-Team Deathmatch"		"classicmode 3; showmenu maps"
menuitem
menuitem "FFA Deathmatch"				"classicmode 4; showmenu maps"
menuitem "Real Deathmatch"				"classicmode 5; showmenu maps"
menuitem "Expert Deathmatch"			"classicmode 6; showmenu maps"
menuitem "Classic Deathmatch"			"classicmode 7; showmenu maps"
menuitem
menuitem "Team One Shot, One Kill"		"classicmode 8; showmenu maps"
menuitem "One Shot, One Kill"			"classicmode 9; showmenu maps"
menuitem
menuitem "Capture the Flag"				"classicmode 10; showmenu maps_flags"
menuitem "Return-Capture the Flag"		"classicmode 11; showmenu maps_flags"
menuitem "Bomber"						"classicmode 12; showmenu maps_flags"
menuitem "Hunt the Flag"				"classicmode 13; showmenu maps"
menuitem "Keep the Flag"				"classicmode 14; showmenu maps_flags"
menuitem "Team Keep the Flag"			"classicmode 15; showmenu maps_flags"
menuitem "Double Keep the Flag"			"classicmode 16; showmenu maps_flags"
menuitem "Team-Double Keep the Flag"	"classicmode 17; showmenu maps_flags"
menuitem
menuitem "Pistol Frenzy"				"classicmode 18; showmenu maps"
menuitem "Last Swiss Standing"			"classicmode 19; showmenu maps"
menuitem
menuitem "Team Survivor"				"classicmode 20; showmenu maps"
menuitem "Survivor"						"classicmode 21; showmenu maps"
menuitem "Zombies"						"classicmode 22; showmenu maps"
menuitem "Onslaught"					"classicmode 23; showmenu maps"
menuitem
menuitem "Knife-Only"					"classicmode 24; showmenu maps"
menuitem "Handheld-Only"				"classicmode 25; showmenu maps"

newmenu Mastermode

menuitem (getlang m_mp_mm_open) 	"mastermode 0"
menuitem (getlang m_mp_mm_lock)		"mastermode 1"
menuitem (getlang m_mp_mm_close) 	"mastermode 2"

newmenu Auto-team

menuitem (getlang m_mp_at_y)	"autoteam 1"
menuitem (getlang m_mp_at_n)	"autoteam 0"

newmenu "serverbrowser help"

menuitem "F1: Display this help menu" -1
menuitem "F3: Search for players by nickname..." [ showmenu "search player" ]
menuitem "F4: Edit favourites..." "showmenu [edit favourites]"
menuitem "F5: Update the serverlist from the masterserver" [updatefrommaster 1; closemenu "serverbrowser help"]
menuitem "F9: Get additional server information" "showmenu [serverinfo]"
menuitem "" -1
menuitem "Options:" -1
menuitemcheckbox "F6: Reverse the sort order:" "$serversortdir" "serversortdir $arg1"
menuitemcheckbox "F7: Only show good servers:" "$showonlygoodservers" "showonlygoodservers $arg1"
menuitemcheckbox "F8: Show minutes remaining:" "$showminremain" "showminremain $arg1"
menuitemcheckbox "Sort official maps ontop:" "$serversortpreferofficial" "serversortpreferofficial $arg1"
menuitemslider "Favourites tag column:	" 0 2 "$serverbrowserhidefavtag" 1 [ "Show always" "Show when used" "Hide always"] "serverbrowserhidefavtag $arg1"
menuitemslider "Server IP & port:		" 0 2 "$serverbrowserhideip" 1 [ "Show" "Show in grey" "Hide"] "serverbrowserhideip $arg1"
menuitemslider "Sort servers by:		" 0 7 "$serversort" 1 [ "Ping" "Number of players" "Max players" "Minutes remaining" "Map name" "Gamemode" "IP address" "Server description"] "serversort $arg1"
menuinitselection 1

alias addfavcatmenu [
		i = (+ 1 (findlist (listfavcats) $arg1))
	newmenu "edit favourites"
	if (< $i 11) [
		menuitemvar (concatword "concat " (mod $i 10) ":  $" sbfavourite_ $arg1 _desc " (concatword <s $" sbfavourite_ $arg1 _tag " r>)") (concatword "showmenu [favourites " $i "]")
		newmenu "serverbrowser help"
		menuitemvar (concatword "concat " $i ":  Toggle category $" sbfavourite_ $arg1 _desc " (concatword <s $" sbfavourite_ $arg1 _tag " r>)") -1
	][
		menuitemvar (concatword "result $" sbfavourite_ $arg1 _desc " (concatword <s $" sbfavourite_ $arg1 _tag " r>)") (concatword "showmenu [favourites " $i "]")
	]
	newmenu (concat favourites $i)
	menuitemtextinput "Tag:  " (concatword "result $" sbfavourite_ $arg1 _tag) (concatword sbfavourite_ $arg1 _tag " = $arg1") "" 15
	menuitemtextinput "Description:  " (concatword "result $" sbfavourite_ $arg1 _desc) (concatword sbfavourite_ $arg1 _desc " = $arg1") "" 45
	menuitem "" -1
	menuitemslider "Background red:	" 0 100 (concatword "$" sbfavourite_ $arg1 _red) 10 "" (concatword sbfavourite_ $arg1 _red " = $arg1")
	menuitemslider "Background green:	" 0 100 (concatword "$" sbfavourite_ $arg1 _green) 10 "" (concatword sbfavourite_ $arg1 _green " = $arg1")
	menuitemslider "Background blue:	" 0 100 (concatword "$" sbfavourite_ $arg1 _blue) 10 "" (concatword sbfavourite_ $arg1 _blue " = $arg1")
	menuitemslider "Background alpha:	" 0 100 (concatword "$" sbfavourite_ $arg1 _alpha) 10 "" (concatword sbfavourite_ $arg1 _alpha " = $arg1")
	menuitem "" -1
	menuitemtextinput "Keyword list:  " (concatword "result $" sbfavourite_ $arg1 _keys) (concatword sbfavourite_ $arg1 _keys " = $arg1") "" 255
	menuitem "" -1
	menuitemtextinput "Weight:  " (concatword "result $" sbfavourite_ $arg1 _weight) (concatword sbfavourite_ $arg1 _weight " = $arg1") "" 10
	menuitem "" -1
	menuitemslider "" 0 1 (concatword "result $" sbfavourite_ $arg1 _ignore) 1 [ "Enable this category" "Ignore this category" ] (concatword sbfavourite_ $arg1 _ignore " = $arg1")
	menuitem "" -1
	menuitem "Show servers of this category" (concat showonlyfavourites $i ";showmenu server") "showonlyfavourites 0"
]

alias addallfavcatmenus [
	newmenu "serverbrowser help"
	menuitem "" -1
	menuitem "Keys to add/remove servers from categories:" -1
	loop ii (listlen (listfavcats)) [addfavcatmenu (at (listfavcats) $ii)]
]

alias lastsearchname ""

newmenu "search player"

menuitemtextinput "Search servers for a player: " "result $lastsearchname" "alias lastsearchname $arg1"
menuitem "2			   [ Search ]" [ closemenu "Search for a player"; searchnickname $lastsearchname]
menuinitselection 1

newmenu getmap
menuitemvar [concatword " This server is using a different version of this map (s0" (curmap 1) "r)"] -1
menuitem "" -1
menuitem "2	[ Download the servers map version and join the game ]" "getmap"
menuitem "3 [ Keep the local map version and disconnect from the server ]" [ showmenu ""; disconnect ]
menuinitselection 2

newmenu voicecom 1 1

menuitem "1. Team Commands" [showmenu "Team Commands"]
menuitem "2. Team State" [showmenu "Team State"]
menuitem "3. Team Talk" [showmenu "Team Talk"]
menuitem "4. Public Talk" [showmenu "Public Talk"]


alias vcrnd [ // pick random shout if possible
	alias len (listlen $arg1)
	if (> $len 1) [
		alias r (rnd $len)
		nextvoice (at $arg1 $r)
		sayvoice (at $arg2 $r)
	] [
		nextvoice $arg1
		sayvoice $arg2
	]
]


alias genvcitem [
	if (> (listlen $arg2) 1) [ alias text (at $arg1 0) ] [ alias text $arg1 ] // split multiple shouts
	alias action (concatword vcrnd " [" $arg2 "]" " [" $arg1 "]")
	menuitem (concatword $arg3 ". " $text) $action // add as numbered list
]


newmenu "Team Commands" 1 1

genvcitem "%Come on, move!"			comeonmove		1
genvcitem "%Cover me!"				coverme			2
genvcitem "%Spread out!"			spreadout		3
genvcitem "%Stay here!"				stayhere		4
genvcitem "%Stay together!"			staytogether	5
genvcitem "%Defend the flag!"		defendtheflag	6
genvcitem "%Recover the flag!"		recovertheflag	7


newmenu "Team State" 1 1

genvcitem ["%Enemy down" "!%got one"]	"enemydown igotone"		1
genvcitem "!%made contact"				imadecontact			2
genvcitem "!%is attacking"				imattacking				3
genvcitem "!%is on defense"				imondefense				4
genvcitem "%Coming in with the flag!"	cominginwiththeflag		5


newmenu "Team Talk" 1 1

genvcitem "%Yes"									yes									1
genvcitem ["%Affirmative" "%Yes" "%All right, Sir"]		"affirmative yes allrightsir"		2
genvcitem "%Negative"								"negative"							3
genvcitem ["%No can do" "%There's no way, Sir!"]		"nocando theresnowaysir"			4
genvcitem "%Sorry"									sorry								5
genvcitem "%I'm on your team, man!"					imonyourteamman						6
genvcitem ["%We did it!" "%Good job, team!"]		"wedidit goodjobteam"				7
genvcitem "%Go get 'em boys!"						gogetemboys							8

newmenu "Public Talk" 1 1

genvcitem "Nice shot"					niceshot	1
genvcitem "Thanks"						affirmative	2
genvcitem "Yes"							yes			3
genvcitem "No"							negative	4
